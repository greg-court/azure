name: 'Terraform PR Validation (APIM)'

on:
  pull_request:
    paths:
      - 'apim/**'
      - 'terraform.tfvars'         # Added root tfvars
      - 'terraform.tfbackend'      # Added root tfbackend
      - '.github/workflows/apim-ci.yml'
    branches:
      - main

jobs:
  terraform_ci:
    name: 'Terraform CI (APIM - Dev Env)'
    uses: greg-court/cicd-templates/.github/workflows/terraform-ci.yml@main
    with:
      working_directory: 'apim'
      tfvars_paths: '["../terraform.tfvars", "environments/dev.tfvars"]'
      tfbackend_path: '../terraform.tfbackend'
      backend_config_overrides: '{"key": "apim.tfstate", "container_name": "dev-tfstate"}'
      environment_name: 'apim-dev-plan'
    secrets: inherit